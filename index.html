<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Asistente</title>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

:root {
  --cyan: #00d9ff;
  --magenta: #ff00a0;
  --purple: #b829dd;
  --dark: #050510;
  --glass: rgba(255, 255, 255, 0.05);
}

body {
  margin: 0;
  height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  background: var(--dark);
  font-family: 'Inter', sans-serif;
  color: white;
  overflow: hidden;
  position: relative;
}

/* Animated starfield */
#starfield {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 0;
}

.star {
  position: absolute;
  background: white;
  border-radius: 50%;
  animation: twinkle 3s infinite;
}

@keyframes twinkle {
  0%, 100% { opacity: 0.2; }
  50% { opacity: 1; }
}

/* Top right menu */
#topMenu {
  position: absolute;
  top: 20px;
  right: 20px;
  z-index: 100;
}

#loginBtn {
  background: linear-gradient(135deg, rgba(0, 217, 255, 0.15), rgba(255, 0, 160, 0.15));
  border: 1px solid rgba(0, 217, 255, 0.4);
  padding: 10px 20px;
  border-radius: 25px;
  color: var(--cyan);
  font-size: 0.75rem;
  font-weight: 600;
  letter-spacing: 1px;
  text-transform: uppercase;
  cursor: pointer;
  backdrop-filter: blur(10px);
  transition: all 0.3s;
}

#loginBtn:hover {
  background: linear-gradient(135deg, var(--cyan), var(--magenta));
  color: white;
  box-shadow: 0 0 30px rgba(0, 217, 255, 0.5);
}

#userBadge {
  display: none;
  align-items: center;
  gap: 10px;
  background: var(--glass);
  padding: 8px 16px;
  border-radius: 25px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  cursor: pointer;
}

#userEmail {
  font-size: 0.8rem;
  max-width: 120px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

#planTag {
  background: linear-gradient(135deg, var(--cyan), var(--purple));
  padding: 4px 10px;
  border-radius: 12px;
  font-size: 0.6rem;
  font-weight: 700;
  text-transform: uppercase;
}

#dropdownMenu {
  position: absolute;
  top: 50px;
  right: 0;
  background: rgba(5, 5, 16, 0.95);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 16px;
  min-width: 200px;
  backdrop-filter: blur(20px);
  display: none;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
}

#dropdownMenu.show {
  display: block;
}

.menuItem {
  padding: 12px 16px;
  border-radius: 10px;
  cursor: pointer;
  font-size: 0.85rem;
  transition: all 0.2s;
  margin-bottom: 4px;
}

.menuItem:hover {
  background: rgba(0, 217, 255, 0.1);
  color: var(--cyan);
}

.menuItem:last-child {
  color: var(--magenta);
}

.menuItem:last-child:hover {
  background: rgba(255, 0, 160, 0.1);
}

/* Notification card */
#notification {
  position: absolute;
  top: 80px;
  width: 90%;
  max-width: 420px;
  background: linear-gradient(135deg, rgba(0, 217, 255, 0.1), rgba(184, 41, 221, 0.1));
  border: 1px solid rgba(0, 217, 255, 0.3);
  border-radius: 20px;
  padding: 20px;
  backdrop-filter: blur(20px);
  z-index: 50;
  transform: translateY(-200px);
  transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  box-shadow: 0 10px 40px rgba(0, 217, 255, 0.2);
}

#notification.show {
  transform: translateY(0);
}

.notifHeader {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 12px;
  font-size: 0.85rem;
  color: var(--cyan);
}

.notifIcon {
  width: 20px;
  height: 20px;
  background: var(--cyan);
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.7rem;
}

.notifText {
  font-size: 0.95rem;
  line-height: 1.5;
  color: rgba(255, 255, 255, 0.9);
}

.notifFooter {
  margin-top: 15px;
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 0.75rem;
  color: rgba(255, 255, 255, 0.5);
}

/* Central sphere */
#sphereContainer {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 200px;
  height: 200px;
  z-index: 10;
}

#sphere {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background: radial-gradient(circle at 30% 30%, var(--cyan), var(--purple) 50%, var(--magenta) 100%);
  box-shadow: 
    0 0 60px rgba(0, 217, 255, 0.5),
    0 0 100px rgba(184, 41, 221, 0.3),
    inset 0 0 40px rgba(255, 255, 255, 0.2);
  position: relative;
  animation: spherePulse 3s ease-in-out infinite;
}

#sphere.listening {
  animation: sphereListen 1s ease-in-out infinite;
  background: radial-gradient(circle at 30% 30%, #ff0040, #ff4080 50%, #ff0066 100%);
  box-shadow: 
    0 0 60px rgba(255, 0, 64, 0.6),
    0 0 100px rgba(255, 0, 100, 0.4);
}

#sphere.speaking {
  animation: sphereSpeak 0.5s ease-in-out infinite;
}

@keyframes spherePulse {
  0%, 100% { transform: scale(1); opacity: 0.9; }
  50% { transform: scale(1.05); opacity: 1; }
}

@keyframes sphereListen {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

@keyframes sphereSpeak {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.03); }
}

/* Orbital rings */
.orbit {
  position: absolute;
  border: 1px solid rgba(0, 217, 255, 0.2);
  border-radius: 50%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.orbit1 { width: 280px; height: 280px; animation: orbit1 10s linear infinite; }
.orbit2 { width: 340px; height: 340px; animation: orbit2 15s linear infinite; border-color: rgba(255, 0, 160, 0.15); }

@keyframes orbit1 {
  0% { transform: translate(-50%, -50%) rotateX(60deg) rotateZ(0deg); }
  100% { transform: translate(-50%, -50%) rotateX(60deg) rotateZ(360deg); }
}

@keyframes orbit2 {
  0% { transform: translate(-50%, -50%) rotateX(70deg) rotateY(10deg) rotateZ(0deg); }
  100% { transform: translate(-50%, -50%) rotateX(70deg) rotateY(10deg) rotateZ(-360deg); }
}

/* Mic button */
#micBtn {
  position: absolute;
  bottom: 140px;
  left: 50%;
  transform: translateX(-50%);
  width: 70px;
  height: 70px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--cyan), var(--purple));
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 10px 40px rgba(0, 217, 255, 0.4);
  z-index: 20;
  transition: all 0.3s;
}

#micBtn:hover {
  transform: translateX(-50%) scale(1.1);
  box-shadow: 0 15px 50px rgba(0, 217, 255, 0.6);
}

#micBtn.recording {
  background: linear-gradient(135deg, #ff0040, #ff6b9d);
  box-shadow: 0 10px 40px rgba(255, 0, 64, 0.5);
  animation: micPulse 1s infinite;
}

@keyframes micPulse {
  0%, 100% { box-shadow: 0 10px 40px rgba(255, 0, 64, 0.5); }
  50% { box-shadow: 0 15px 60px rgba(255, 0, 64, 0.8); }
}

.micIcon {
  width: 28px;
  height: 28px;
  fill: white;
}

/* Context buttons */
#contextButtons {
  position: absolute;
  bottom: 50px;
  display: flex;
  gap: 20px;
  z-index: 20;
}

.ctxBtn {
  width: 60px;
  height: 60px;
  border-radius: 18px;
  background: var(--glass);
  border: 1px solid rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s;
  position: relative;
  overflow: hidden;
}

.ctxBtn::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, var(--cyan), var(--purple));
  opacity: 0;
  transition: opacity 0.3s;
}

.ctxBtn:hover::before {
  opacity: 0.2;
}

.ctxBtn:hover {
  transform: translateY(-5px) scale(1.05);
  border-color: var(--cyan);
  box-shadow: 0 10px 30px rgba(0, 217, 255, 0.3);
}

.ctxBtn:active {
  transform: translateY(-2px) scale(0.98);
}

.ctxBtn svg {
  width: 26px;
  height: 26px;
  fill: rgba(255, 255, 255, 0.7);
  position: relative;
  z-index: 1;
  transition: all 0.3s;
}

.ctxBtn:hover svg {
  fill: var(--cyan);
}

/* Transcribed text */
#transcribed {
  position: absolute;
  bottom: 230px;
  font-size: 0.9rem;
  color: rgba(255, 255, 255, 0.6);
  font-style: italic;
  z-index: 10;
}

/* Text input modal */
#inputModal {
  position: fixed;
  inset: 0;
  background: rgba(5, 5, 16, 0.98);
  backdrop-filter: blur(30px);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

#inputModal.show {
  display: flex;
}

#inputBox {
  width: 90%;
  max-width: 400px;
  background: var(--glass);
  border: 1px solid rgba(0, 217, 255, 0.2);
  border-radius: 24px;
  padding: 30px;
  backdrop-filter: blur(20px);
}

#textInput {
  width: 100%;
  background: rgba(0, 0, 0, 0.3);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 18px;
  color: white;
  font-size: 1rem;
  font-family: inherit;
  resize: none;
  height: 100px;
  margin-bottom: 15px;
  outline: none;
}

#textInput:focus {
  border-color: var(--cyan);
}

#sendBtn {
  width: 100%;
  padding: 16px;
  background: linear-gradient(135deg, var(--cyan), var(--purple));
  border: none;
  border-radius: 12px;
  color: white;
  font-weight: 600;
  font-size: 0.9rem;
  cursor: pointer;
  transition: all 0.3s;
}

#sendBtn:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 30px rgba(0, 217, 255, 0.4);
}

/* Mobile */
@media (max-width: 600px) {
  #sphereContainer {
    width: 160px;
    height: 160px;
  }
  
  .orbit1 { width: 220px; height: 220px; }
  .orbit2 { width: 280px; height: 280px; }
  
  #contextButtons {
    gap: 15px;
  }
  
  .ctxBtn {
    width: 55px;
    height: 55px;
  }
}
</style>
</head>
<body>

<!-- Starfield -->
<div id="starfield"></div>

<!-- Top Menu -->
<div id="topMenu">
  <button id="loginBtn" onclick="toggleDropdown()">Iniciar Sesi贸n</button>
  
  <div id="userBadge" onclick="toggleDropdown()">
    <span id="userEmail"></span>
    <span id="planTag">Plan</span>
  </div>
  
  <div id="dropdownMenu">
    <div class="g_id_signin" data-type="standard" data-theme="outline" data-size="medium"></div>
    <div class="menuItem" onclick="upgradePlan()">Mejorar Plan</div>
    <div class="menuItem" onclick="showReminders()">Ver Recordatorios</div>
    <div class="menuItem" onclick="logout()">Cerrar Sesi贸n</div>
  </div>
</div>

<!-- Notification -->
<div id="notification">
  <div class="notifHeader">
    <div class="notifIcon"></div>
    <span id="notifTime">24 abr 18:00</span>
  </div>
  <div class="notifText" id="notifText">Te recuerdo que hoy es el cumplea帽os de Caetano a las 18 horas en la escondida calle Devenson al final.</div>
  <div class="notifFooter">
    <span></span>
    <span>Evento programado</span>
  </div>
</div>

<!-- Central Sphere -->
<div id="sphereContainer">
  <div class="orbit orbit1"></div>
  <div class="orbit orbit2"></div>
  <div id="sphere"></div>
</div>

<!-- Transcribed text -->
<div id="transcribed"></div>

<!-- Mic Button -->
<button id="micBtn" onclick="toggleRecording()">
  <svg class="micIcon" viewBox="0 0 24 24">
    <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
    <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
  </svg>
</button>

<!-- Context Buttons -->
<div id="contextButtons">
  <button class="ctxBtn" onclick="quickAction('check')" title="Tareas">
    <svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
  </button>
  <button class="ctxBtn" onclick="quickAction('calendar')" title="Calendario">
    <svg viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 10H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm-8 4H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z"/></svg>
  </button>
  <button class="ctxBtn" onclick="openTextModal()" title="Escribir">
    <svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"/></svg>
  </button>
  <button class="ctxBtn" onclick="quickAction('settings')" title="Ajustes">
    <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L5.09 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
  </button>
</div>

<!-- Text Input Modal -->
<div id="inputModal" onclick="closeModalOnBg(event)">
  <div id="inputBox">
    <textarea id="textInput" placeholder="驴Qu茅 necesit谩s?"></textarea>
    <button id="sendBtn" onclick="sendText()">Enviar</button>
  </div>
</div>

<script>
let userEmail = null;
let mediaRecorder;
let audioChunks = [];
let isRecording = false;

const sphere = document.getElementById('sphere');
const micBtn = document.getElementById('micBtn');
const transcribed = document.getElementById('transcribed');
const notification = document.getElementById('notification');

// Create starfield
function createStars() {
  const container = document.getElementById('starfield');
  for (let i = 0; i < 150; i++) {
    const star = document.createElement('div');
    star.className = 'star';
    star.style.left = Math.random() * 100 + '%';
    star.style.top = Math.random() * 100 + '%';
    star.style.width = Math.random() * 2 + 1 + 'px';
    star.style.height = star.style.width;
    star.style.animationDelay = Math.random() * 3 + 's';
    container.appendChild(star);
  }
}
createStars();

// Google Sign In
function handleCredentialResponse(response) {
  const payload = JSON.parse(atob(response.credential.split('.')[1]));
  userEmail = payload.email;
  
  document.getElementById('loginBtn').style.display = 'none';
  document.getElementById('userBadge').style.display = 'flex';
  
  const emailSpan = document.getElementById('userEmail');
  emailSpan.textContent = window.innerWidth < 600 
    ? userEmail.split('@')[0].substring(0, 6) + '..' 
    : userEmail;
  
  document.getElementById('dropdownMenu').classList.remove('show');
}

function toggleDropdown() {
  document.getElementById('dropdownMenu').classList.toggle('show');
}

function logout() {
  userEmail = null;
  document.getElementById('loginBtn').style.display = 'block';
  document.getElementById('userBadge').style.display = 'none';
  document.getElementById('dropdownMenu').classList.remove('show');
  hideNotification();
}

function upgradePlan() {
  showNotification('Sistema', 'Funci贸n disponible pr贸ximamente');
}

function showReminders() {
  if (!userEmail) return;
  // Fetch reminders
}

// Notification system
function showNotification(title, text) {
  document.getElementById('notifTime').textContent = new Date().toLocaleString('es-ES', { 
    day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' 
  });
  document.getElementById('notifText').textContent = text;
  notification.classList.add('show');
  
  setTimeout(() => hideNotification(), 5000);
}

function hideNotification() {
  notification.classList.remove('show');
}

// Recording
async function toggleRecording() {
  if (!userEmail) {
    showNotification('Sistema', 'Debes iniciar sesi贸n para continuar');
    return;
  }

  if (!isRecording) {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);
      audioChunks = [];
      
      mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
      mediaRecorder.onstop = processAudio;
      mediaRecorder.start();
      
      isRecording = true;
      sphere.classList.add('listening');
      micBtn.classList.add('recording');
      transcribed.textContent = 'Escuchando...';
      
    } catch(err) {
      showNotification('Error', 'No se pudo acceder al micr贸fono');
    }
  } else {
    mediaRecorder.stop();
    mediaRecorder.stream.getTracks().forEach(t => t.stop());
    
    isRecording = false;
    sphere.classList.remove('listening');
    micBtn.classList.remove('recording');
    transcribed.textContent = 'Procesando...';
  }
}

async function processAudio() {
  // Send to transcribe and process
  sphere.classList.add('speaking');
  
  // Simulate response
  setTimeout(() => {
    sphere.classList.remove('speaking');
    transcribed.textContent = '';
    showNotification('Recordatorio', 'Te recuerdo que hoy es el cumplea帽os de Caetano a las 18 horas');
    speak('Te recuerdo que hoy es el cumplea帽os de Caetano a las 18 horas');
  }, 1500);
}

function speak(text) {
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = 'es-ES';
  utterance.rate = 0.9;
  speechSynthesis.speak(utterance);
}

// Quick actions
function quickAction(type) {
  if (!userEmail) {
    showNotification('Sistema', 'Debes iniciar sesi贸n');
    return;
  }
  
  const actions = {
    check: () => showNotification('Tareas', 'No tienes tareas pendientes'),
    calendar: () => showNotification('Calendario', 'Pr贸ximo evento: Ma帽ana 13hs'),
    settings: () => showNotification('Ajustes', 'Configuraci贸n guardada')
  };
  
  actions[type]?.();
}

// Text modal
function openTextModal() {
  if (!userEmail) {
    showNotification('Sistema', 'Debes iniciar sesi贸n');
    return;
  }
  document.getElementById('inputModal').classList.add('show');
  document.getElementById('textInput').focus();
}

function closeModalOnBg(e) {
  if (e.target.id === 'inputModal') {
    document.getElementById('inputModal').classList.remove('show');
  }
}

function sendText() {
  const text = document.getElementById('textInput').value.trim();
  if (!text) return;
  
  document.getElementById('inputModal').classList.remove('show');
  document.getElementById('textInput').value = '';
  transcribed.textContent = text;
  
  // Process text...
  sphere.classList.add('speaking');
  setTimeout(() => {
    sphere.classList.remove('speaking');
    showNotification('Respuesta', 'Entendido, lo he guardado');
    speak('Entendido, lo he guardado');
  }, 1000);
}

// Close dropdown when clicking outside
document.addEventListener('click', (e) => {
  const menu = document.getElementById('dropdownMenu');
  const btn = document.getElementById('loginBtn');
  const badge = document.getElementById('userBadge');
  
  if (!menu.contains(e.target) && e.target !== btn && e.target !== badge && !badge.contains(e.target)) {
    menu.classList.remove('show');
  }
});
</script>
</body>
</html>
