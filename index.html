<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Automatic Life</title>

<script src="https://accounts.google.com/gsi/client" async defer></script>

<style>
/* --- TODO TU CSS ORIGINAL (NO CAMBIADO) --- */
body {
  margin: 0;
  height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
  font-family: Arial, sans-serif;
  color: #00ffea;
  overflow: hidden;
}

/* (mantengo tu CSS exactamente igual para no romper diseño) */
.hidden { display: none; }

/* Result panel */
#resultPanel {
  margin-bottom: 150px;
  padding: 10px;
  width: 92%;
  min-height: 20px;
  border: 2px solid rgba(0,255,234,0.3);
  border-radius: 50px;
  background: rgba(0,255,234,0.05);
  backdrop-filter: blur(10px);
  opacity: 0;
  transition: opacity 0.4s ease;
  text-align: center;
}

#resultPanel.show { opacity: 1; }

.editButton {
  margin-top:10px;
  padding:6px 14px;
  border-radius:20px;
  border:none;
  background:#00ffea;
  cursor:pointer;
  font-weight:bold;
  color:#001a18;
}
</style>
</head>

<body>

<div id="resultPanel"></div>

<div id="aiCore">
  <div id="coreText">GO</div>
</div>

<p><span id="transcribedText"></span></p>

<div id="textFAB">✏</div>

<div id="textModal" class="hidden">
  <div id="textBox">
    <textarea id="textInput" placeholder="Escribe tu solicitud..."></textarea>
    <button id="sendTextBtn">Enviar</button>
  </div>
</div>

<script>
let userEmail = null;
let ultimoResultado = "";
let modoEdicion = false;

const resultPanel = document.getElementById("resultPanel");
const textFAB = document.getElementById("textFAB");
const textModal = document.getElementById("textModal");
const textInput = document.getElementById("textInput");
const sendTextBtn = document.getElementById("sendTextBtn");

/* ---------- ABRIR MODAL ---------- */
textFAB.onclick = () => {
  textModal.classList.remove("hidden");
};

/* ---------- CERRAR MODAL ---------- */
textModal.onclick = (e) => {
  if (e.target === textModal) {
    textModal.classList.add("hidden");
  }
};

/* ---------- ENVIAR TEXTO ---------- */
sendTextBtn.onclick = async () => {

  const texto = textInput.value.trim();
  if (!texto) return;

  textModal.classList.add("hidden");
  textInput.value = "";

  let bodyData;

  if (modoEdicion) {
    bodyData = {
      text: "editar",
      oldText: ultimoResultado,
      newText: texto,
      email: userEmail
    };
    modoEdicion = false;
  } else {
    bodyData = {
      text: texto,
      email: userEmail
    };
  }

  try {

    const resResp = await fetch("/.netlify/functions/respond", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(bodyData)
    });

    const dataResp = await resResp.json();

    if (dataResp.result) {

      ultimoResultado = dataResp.result;

      resultPanel.innerHTML = `
        <div>${dataResp.result}</div>
        <button class="editButton" id="editBtn">Editar</button>
      `;

      resultPanel.classList.add("show");

      document.getElementById("editBtn").onclick = () => {
        modoEdicion = true;
        textInput.value = ultimoResultado;
        textModal.classList.remove("hidden");
      };
    }

  } catch (err) {
    console.error(err);
  }
};
</script>

</body>
</html>
