<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Hablar</title>
</head>
<body>

  <h1>Hablar</h1>

  <button id="recordBtn">ğŸ™ï¸ Hablar</button>
  <p id="status"></p>
  <pre id="result"></pre>

  <script>
    let mediaRecorder;
    let audioChunks = [];

    const btn = document.getElementById("recordBtn");
    const status = document.getElementById("status");
    const result = document.getElementById("result");

    btn.onclick = async () => {
      if (!mediaRecorder || mediaRecorder.state === "inactive") {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);

        audioChunks = [];
        mediaRecorder.ondataavailable = e => audioChunks.push(e.data);

        mediaRecorder.onstop = sendAudio;

        mediaRecorder.start();
        status.textContent = "Grabando...";
        btn.textContent = "â¹ï¸ Detener";
      } else {
        mediaRecorder.stop();
        status.textContent = "Audio grabado âœ”ï¸ (siguiente paso: enviarlo)";
        btn.textContent = "ğŸ™ï¸ Hablar";
      }
    };

    async function sendAudio() {
      const audioBlob = new Blob(audioChunks, { type: "audio/webm" });
      const formData = new FormData();
      formData.append("file", audioBlob, "audio.webm");

      status.textContent = "Enviando audio...";

      const res = await fetch("/.netlify/functions/transcribe", {
        method: "POST",
        body: formData
      });

      const data = await res.json();
      result.textContent = JSON.stringify(data, null, 2);
      status.textContent = "Listo âœ…";
    }
  </script>

</body>
</html>
